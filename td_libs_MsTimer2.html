<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>MsTimer2 and FlexiTimer2 Arduino Libraries, Run a Function At Regular Intervals</title>
<base target="_top">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/favicon.ico">
<link rel="stylesheet" href="/style.css" type="text/css">
<meta name="MSSmartTagsPreventParsing" content="TRUE">
<link rel="stylesheet" href="td_libs.css" type="text/css">
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000D0" vlink="#202080">
<!--nav begin-->
<!--htdig_noindex-->
<table width="100%" cellspacing=2 cellpadding=0>
<tr><td align=left rowspan=2>
<table cellspacing=0  cellpadding=0 width=312>
<tr><td align=right>
<a href="#navend"><img src="/img/1x1.gif" width=1 height=10
alt="skip navigational links" border=0
hspace=0 vspace=0></a><a href="/"><img src="/img/logo.gif" alt="PJRC"
width=276 height=31 border=0></a></td></tr>
</table>
</td><td align=right valign=top>
</td></tr>
<tr><td align=right valign=bottom>
<small>
<a href="https://www.pjrc.com/cart/cart.php">Shopping&nbsp;Cart</a>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/cgi-bin/archive/summary">Download&nbsp;Website</a>
</small>
</td></tr></table>
<table cellspacing=0 cellpadding=6 border=0 width="100%">
<tr bgcolor="#D0E0FF">
<td align=center><a href="/">Home</a></td>
<td align=center><a href="/store/">Products</a></td>
<td align=center><a href="/teensy/">Teensy</a></td>
<td align=center><a href="/blog/">Blog</a></td>
<td align=center><a href="https://forum.pjrc.com/">Forum</a></td>
</tr></table>
<table cellspacing=0 cellpadding=2 width="100%">
<tr bgcolor="#F0F0F0"><td align=left>
<small>You are here:
<a href="/teensy/">Teensy</a>
<img src="/img/b.gif" width=10 height=10 alt="">
<a href="teensyduino.html">Teensyduino</a>
<img src="/img/b.gif" width=10 height=10 alt="">
<a href="td_libs.html">Libraries</a>
<img src="/img/b.gif" width=10 height=10 alt="">
<span style="background-color: #B0E4A8">MsTimer2</span>
</small></td><td align=right>
<!-- <small><a href="/search/">Search PJRC</a></small>
 -->
</td></tr></table>
<p>
<table width="100%" border=0 cellspacing=0 cellpadding=0>
<tr><td width=172 valign=top>
<table width=172 border=0 cellspacing=0 cellpadding=6>
<tr><td bgcolor="#D0E0FF" align=center>
<big><b>PJRC Store</b></big>
</td></tr>
<tr><td bgcolor="#F0F0F0">
<small>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensy41.html">Teensy 4.1, $26.85</a><br>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensy40.html">Teensy 4.0, $19.95</a><br>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensy36.html">Teensy 3.6, $29.25</a><br>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensy35.html">Teensy 3.5, $24.25</a><br>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensy32.html">Teensy 3.2, $19.80</a><br>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensylc.html">Teensy LC, $11.65</a><br>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensy.html">Teensy 2.0, $16.00</a><br>
<img src="/img/a.gif" width=10 height=10 alt="" align=middle>
<a href="/store/teensypp.html">Teensy++ 2.0, $24.00</a><br>
</small></td></tr>
<tr><td height=15></td></tr>
<tr><td bgcolor="#D0E0FF" align=center>
<big><b>Teensy</b></big>
</td></tr>
<tr><td bgcolor="#F0F0F0">
<small>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="index.html">Main Page</a><br>
<a href="techspecs.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>Hardware</b></a><br>
<a href="first_use.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>Getting Started</b></a><br>
<a href="tutorial.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>Tutorial</b></a><br>
<a href="pins.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>How-To Tips</b></a><br>
<a href="usb_debug_only.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>Code Library</b></a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="projects.html">Projects</a><br>
<img src="/img/b.gif" width=10 height=10 alt="">
<b>Teensyduino</b><br>
</small>
<div style="padding-left: 1.2em">
<small>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="teensyduino.html">Main</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_download.html">Download+Install</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_usage.html">Basic Usage</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_digital.html">Digital I/O</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_pulse.html">PWM & Tone</a><br>
<a href="td_timing.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>Timing</b></a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_code_security.html">Code Security</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_serial.html">USB Serial</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_keyboard.html">USB Keyboard</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_mouse.html">USB Mouse</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_joystick.html">USB Joystick</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_midi.html">USB MIDI</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_flightsim.html">USB Flight Sim</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_uart.html">Serial</a><br>
<img src="/img/b.gif" width=10 height=10 alt="">
<b>Libraries</b><br>
</small>
<div style="padding-left: 1.2em">
<small>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs.html">Main List</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_GLCD.html">GLCD</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_LiquidCrystal.html">LiquidCrystal</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_OctoWS2811.html">OctoWS2811</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_FastSPI_LED.html">FastSPI_LED</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Matrix.html">Matrix/Sprite</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_LedDisplay.html">LedDisplay</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_LedControl.html">LedControl</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_DogLcd.html">DogLcd</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_ST7565.html">ST7565</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_AltSoftSerial.html">AltSoftSerial</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_NewSoftSerial.html">NewSoftSerial</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_SoftwareSerial.html">SoftwareSerial</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_MIDI.html">MIDI</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_PS2Keyboard.html">PS2Keyboard</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_DmxSimple.html">DmxSimple</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Firmata.html">Firmata</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Wire.html">Wire</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_SPI.html">SPI</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_OneWire.html">OneWire</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_XBee.html">XBee</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_VirtualWire.html">VirtualWire</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_x10.html">X10</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_IRremote.html">IRremote</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_TinyGPS.html">TinyGPS</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_USBHostShield.html">USBHostShield</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Ethernet.html">Ethernet</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Bounce.html">Bounce</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Keypad.html">Keypad</a><br>
<a href="td_libs_Audio.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>Audio</b></a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Encoder.html">Encoder</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Ping.html">Ping</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_CapacitiveSensor.html">CapacitiveSensor</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_FreqCount.html">FreqCount</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_FreqMeasure.html">FreqMeasure</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Servo.html">Servo</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_PulsePosition.html">PulsePosition</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Stepper.html">Stepper</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_AccelStepper.html">AccelStepper</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_FrequencyTimer2.html">FrequencyTimer2</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Tlc5940.html">Tlc5940</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_SoftPWM.html">SoftPWM</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_ShiftPWM.html">ShiftPWM</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Time.html">Time</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_TimeAlarms.html">TimeAlarms</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_DS1307RTC.html">DS1307RTC</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_Metro.html">Metro</a><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_TimerOne.html">TimerOne</a><br>
<img src="/img/b.gif" width=10 height=10 alt="selected">
<span style="background-color: #B0E4A8">MsTimer2</span><br>
<img src="/img/a.gif" width=10 height=10 alt="">
<a href="td_libs_EEPROM.html">EEPROM</a><br>
</small>
</div>
<small>
</small>
</div>
<small>
<a href="pinout.html"><img src="/img/c.gif" width=10 height=10 alt="" border=0>
<b>Reference</b></a><br>
</small></td></tr>
<tr><td height=60></td></tr>
</table><br>
<a name="navend"> </a>
</td>
<td width=18></td>
<td valign=top>
<!--/htdig_noindex-->
<!--nav end-->


<h1>MsTimer2 and FlexiTimer2 Libraries</h1>

MsTimer2, by Javier Valencia, lets you periodically run a function, by a configurable number of milliseconds.
<p>
FlexiTimer2 is version of MsTimer2 by Wim Leers, which makes the interval resolution configurable, rather than being fixed at 1 millisecond steps
<p>
<table><tr><td valign=top><b>Download</b>:</td><td>
Included with the <a href="td_download.html">Teensyduino Installer</a><br>
Latest MsTimer2 on <a href="https://github.com/PaulStoffregen/MsTimer2">Github</a><br>
Latest FlexiTimer2 on <a href="https://github.com/PaulStoffregen/FlexiTimer2">Github</a>
</td></tr></table>
<!--<b>Download</b>: <a href="arduino_libraries/MsTimer2.zip">MsTimer2.zip</a> (version 0.7)<br>
<b>Download</b>: <a href="arduino_libraries/FlexiTimer2.zip">FlexiTimer2.zip</a> (updated for Teensy 3.x)-->
<p>

<h2>Hardware Requirements</h2>

TODO: table showing pins unusable as PWM: Teensy 2.0: 10 and 12.  Teensy++ 2.0: 1 and 24.
<p>
MsTimer2 &amp; FlexiTimer2 work on Teensy LC &amp; 3.0 - 3.6.  Internally,
<a href="td_timing_IntervalTimer.html">IntervalTimer</a>
is used these 32 bit boards.  For new projects, direct use of IntervalTimer
is recommended.

<h2>Basic Usage</h2>

TODO: write this
<!--
<span style="color: #CC6600;">Metro</span> myname = <span style="color: #CC6600;">Metro</span>(milliseconds);
<p class=desc>
Create a Metro object that schedules every "milliseconds".  You can create as
many Metro objects as you need, each with its own name and separate interval.
</p>
myname.<span style="color: #CC6600;">check</span>()
<p class=desc>
Check if the interval has elapsed.  Returns true if it has, false if it has not (yet).
</p>
myname.<span style="color: #CC6600;">interval</span>(milliseconds)
<p class=desc>
Change to a new interval setting.
</p>
myname.<span style="color: #CC6600;">reset</span>()
<p class=desc>
Reset the interval.
</p>
-->

<h2>Example Program</h2>

TODO: add this
<!--
The example program, available from <b>File &gt; Examples &gt; Metro &gt; serialInterval</b>
uses Metro to schedule reading the analog inputs 4 times per second.
<p>
<img src="td_libs_Metro.png">
<p>

<pre>
<span style="color: #7E7E7E;">//&nbsp;This&nbsp;example&nbsp;sends&nbsp;a&nbsp;Serial&nbsp;message&nbsp;every&nbsp;250&nbsp;milliseconds</span>

#include&nbsp;&lt;<span style="color: #CC6600;">Metro</span>.h&gt; <span style="color: #7E7E7E;">// Include the Metro library</span>

<span style="color: #CC6600;">Metro</span> serialMetro = <span style="color: #CC6600;">Metro</span>(250);  <span style="color: #7E7E7E;">// Instantiate an instance</span>

<span style="color: #CC6600;">void</span> <span style="color: #CC6600;"><b>setup</b></span>() {
&nbsp;&nbsp;<span style="color: #CC6600;">Serial</span>.<span style="color: #CC6600;">begin</span>(115200); <span style="color: #7E7E7E;">// Start the Serial communication</span>
}

<span style="color: #CC6600;">void</span> <span style="color: #CC6600;"><b>loop</b></span>() {

&nbsp;&nbsp;<span style="color: #CC6600;">if</span> (serialMetro.<span style="color: #CC6600;">check</span>() == 1) { <span style="color: #7E7E7E;">// check if the metro has passed it's interval .</span>
&nbsp;&nbsp;<span style="color: #7E7E7E;">// Output all the analog readings seperated by a space character</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #CC6600;">for</span> (<span style="color: #CC6600;">int</span> i = 0; i &lt; 6; i++ ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #CC6600;">Serial</span>.<span style="color: #CC6600;">print</span> (<span style="color: #CC6600;">analogRead</span>( i) );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #CC6600;">Serial</span>.<span style="color: #CC6600;">print</span>(32,<span style="color: #006699;">BYTE</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7E7E7E;">// Terminate message with a linefeed and a carriage return</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #CC6600;">Serial</span>.<span style="color: #CC6600;">print</span>(13,<span style="color: #006699;">BYTE</span>);
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #CC6600;">Serial</span>.<span style="color: #CC6600;">print</span>(10,<span style="color: #006699;">BYTE</span>);
&nbsp;&nbsp;}
}
</pre>
-->

<h2>Interrupt Context Issues</h2>

MsTimer2 and FlexiTimer2 will call your function from interrupt context.  Because it will
interrupt your program at any moment, special design is necessary to share data with the
rest of your program.
<p>
Variables usually need to be "volatile" types.  Volatile tells the compiler to
avoid optimizations that assume variable can not spontaneously change.  Because your
function may change variables while your program is using them, the compiler needs
this hint.  But volatile alone is often not enough.
<p>
When accessing shared variables, usually interrupts must be disabled.  Even with
volatile, if the interrupt changes a multi-byte variable between a sequence of
instructions, it can be read incorrectly.  If your data is multiple variables,
such as an array and a count, usually interrupts need to be disabled for the entire
sequence of your code which accesses the data.
<p>
TODO: an example.



<h2>Details</h2>

The original version of these libraries are at:
<p>
<a href="http://www.arduino.cc/playground/Main/MsTimer2">MsTimer2 page</a>.
<p>
<a href="http://www.arduino.cc/playground/Main/FlexiTimer2">FlexiTimer2 page</a>.

<p>
New development at: <a href="https://github.com/PaulStoffregen/MsTimer2">
https://github.com/PaulStoffregen/MsTimer2</a> and
<a href="https://github.com/PaulStoffregen/FlexiTimer2">https://github.com/PaulStoffregen/FlexiTimer2</a>.


</td></tr></table></body></html>
